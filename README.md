# Микросервис для скачивания файлов

Микросервис помогает работе основного сайта, сделанного на CMS и обслуживает
запросы на скачивание архивов с файлами. Микросервис не умеет ничего, кроме упаковки файлов
в архив. Закачиваются файлы на сервер через FTP или админку CMS.

Создание архива происходит на лету по запросу от пользователя. Архив не сохраняется на диске, вместо этого по мере упаковки он сразу отправляется пользователю на скачивание.

От неавторизованного доступа архив защищен хешом в адресе ссылки на скачивание, например: `http://host.ru/archive/3bea29ccabbbf64bdebcc055319c5745/`. Хеш задается названием каталога с файлами, выглядит структура каталога так:

```
- photos
    - 3bea29ccabbbf64bdebcc055319c5745
      - 1.jpg
      - 2.jpg
      - 3.jpg
    - af1ad8c76fda2e48ea9aed2937e972ea
      - 1.jpg
      - 2.jpg
```


## Как установить

Для работы микросервиса нужен Python версии не ниже 3.6.

1. Установите необходимые зависимости с помощью `pip`
  ```bash
  pip install -r requirements.txt
  ```

2. Создайте файл `.env` в корне проекта и заполните его необходимыми данными:
  ```env
  PHOTOS_DIRECTORY=абсолютный или относительный адрес каталога с фотографиями.

  CHUNK_SIZE=размер одного чанка в байтах, по-умолчанию 512000 байт (500 Кб)
  RESPONSE_DELAY=задержка ответа сервера в секундах, по-умолчанию 0 секунд
  LOGGING=включение или выключение логгирование, по-умолчанию True (включено)

  SERVICE_HOST=хост, на котором будет запущен сервис, по-умолчанию 127.0.0.1
  SERVICE_PORT=порт, на котором будет запущен сервис, по-умолчанию 8080
  ```

## Как запустить

```bash
python3 server.py
```

Сервер запустится на указанных хосте и порте, чтобы проверить его работу перейдите в браузере на страницу `http://host:port/`.

## Как развернуть на сервере

```bash
python3 server.py
```

После этого перенаправить на микросервис запросы, начинающиеся с `/archive/`. Например:

```
GET http://host.ru/archive/3bea29ccabbbf64bdebcc055319c5745/
GET http://host.ru/archive/af1ad8c76fda2e48ea9aed2937e972ea/
```

# Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).